<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Email Professionnel - IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // State management
        let state = {
            isFirstEmail: true,
            emailHistory: '',
            newEmailContent: '',
            language: 'auto',
            tone: 'professional',
            formality: 'vous',
            length: 'detailed',
            generatedEmail: '',
            isGenerating: false,
            isCopied: false
        };

        // Icons SVG
        const icons = {
            mail: '<svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>',
            send: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>',
            copy: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>',
            check: '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>'
        };

        function buildPrompt() {
            let prompt = `Tu es un assistant professionnel de r√©daction d'emails. Voici les param√®tres :\n\n`;

            if (state.isFirstEmail) {
                prompt += `**Type d'email** : Premier email (nouvelle conversation)\n`;
            } else {
                prompt += `**Type d'email** : R√©ponse √† un √©change existant\n`;
                prompt += `**Historique des √©changes pr√©c√©dents** :\n${state.emailHistory}\n\n`;
            }

            prompt += `**Contenu/instruction pour l'email** :\n${state.newEmailContent}\n\n`;
            prompt += `**Langue cible** : ${state.language === 'auto' ? 'D√©tecter automatiquement et garder la m√™me langue' : state.language}\n`;
            prompt += `**Ton souhait√©** : ${state.tone === 'professional' ? 'Professionnel' : state.tone === 'friendly' ? 'Amical' : 'D√©contract√©'}\n`;
            prompt += `**Forme d'adresse** : ${state.formality === 'vous' ? 'Vouvoiement' : 'Tutoiement'}\n`;
            prompt += `**Longueur** : ${state.length === 'detailed' ? 'D√©taill√©e (compl√®te et exhaustive)' : 'Courte (concise et directe)'}\n\n`;

            prompt += `INSTRUCTIONS IMPORTANTES :
1. Corrige toutes les fautes d'orthographe, de grammaire et de ponctuation
2. Am√©liore la formulation pour qu'elle soit claire et ${state.tone}
3. Respecte le ${state.formality === 'vous' ? 'vouvoiement' : 'tutoiement'}
4. ${state.length === 'detailed' ? 'D√©veloppe les points importants avec des d√©tails pertinents' : 'Sois bref et va droit au but'}
5. Si historique fourni, assure une coh√©rence avec les √©changes pr√©c√©dents
6. Structure l'email de mani√®re professionnelle avec salutation et formule de politesse adapt√©es
7. ${state.language !== 'auto' ? `Traduis l'email en ${state.language}` : 'Garde la langue d\'origine du contenu fourni'}

R√©ponds UNIQUEMENT avec le texte de l'email final, sans commentaires ni explications suppl√©mentaires.`;

            return prompt;
        }

        async function handleGenerate() {
            state.isGenerating = true;
            state.generatedEmail = '';
            render();

            try {
                const prompt = buildPrompt();
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                state.generatedEmail = data.result;
            } catch (error) {
                console.error('Erreur:', error);
                state.generatedEmail = `‚ùå Erreur: ${error.message}`;
            } finally {
                state.isGenerating = false;
                render();
            }
        }

        async function handleAnalyze() {
            state.isGenerating = true;
            render();

            try {
                const prompt = `Analyse cet email re√ßu et extrait les informations cl√©s :\n\n${state.newEmailContent}\n\nFournis :\n1. Le contexte principal\n2. Les points √† adresser\n3. Le ton de l'exp√©diteur\n4. Suggestions pour la r√©ponse\n\nFormat ta r√©ponse de mani√®re claire et structur√©e.`;
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                state.generatedEmail = data.result;
            } catch (error) {
                state.generatedEmail = `‚ùå Erreur: ${error.message}`;
            } finally {
                state.isGenerating = false;
                render();
            }
        }

        async function handleSummarize() {
            state.isGenerating = true;
            render();

            try {
                const prompt = `R√©sume cet √©change d'emails de mani√®re concise :\n\n${state.emailHistory || state.newEmailContent}\n\nFournis un r√©sum√© structur√© avec :\n1. Les d√©cisions prises\n2. Les actions √† faire\n3. Les points en attente\n4. Le contexte g√©n√©ral\n\nSois clair et concis.`;
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                state.generatedEmail = data.result;
            } catch (error) {
                state.generatedEmail = `‚ùå Erreur: ${error.message}`;
            } finally {
                state.isGenerating = false;
                render();
            }
        }

        async function handleCopy() {
            try {
                await navigator.clipboard.writeText(state.generatedEmail);
                state.isCopied = true;
                render();
                setTimeout(() => {
                    state.isCopied = false;
                    render();
                }, 2000);
            } catch (error) {
                console.error('Erreur lors de la copie:', error);
            }
        }

        function render() {
            const wordCount = state.generatedEmail.split(/\s+/).filter(w => w.length > 0).length;
            const charCount = state.generatedEmail.length;

            document.getElementById('root').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-red-50 p-6">
                    <div class="max-w-7xl mx-auto">
                        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
                            <!-- Header -->
                            <div class="bg-gradient-to-r from-blue-600 to-red-600 text-white p-6">
                                <h1 class="text-3xl font-bold flex items-center gap-3">
                                    ${icons.mail}
                                    Assistant Email Professionnel
                                </h1>
                                <p class="text-blue-100 mt-2">Correction, am√©lioration et traduction d'emails avec IA</p>
                            </div>

                            <!-- Title -->
                            <div class="border-b border-gray-200 bg-white">
                                <div class="py-4 px-6">
                                    <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                                        ${icons.send}
                                        R√©daction d'email
                                    </h2>
                                </div>
                            </div>

                            <!-- Content -->
                            <div class="p-6">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Left Column -->
                                    <div class="space-y-6">
                                        <!-- First Email Checkbox -->
                                        <div class="bg-gradient-to-r from-blue-50 to-red-50 p-4 rounded-lg">
                                            <label class="flex items-center gap-2 font-semibold text-gray-700 mb-3">
                                                <input 
                                                    type="checkbox" 
                                                    id="firstEmailCheck"
                                                    ${state.isFirstEmail ? 'checked' : ''}
                                                    onchange="state.isFirstEmail = this.checked; render();"
                                                    class="w-5 h-5 text-blue-600 rounded"
                                                />
                                                Premier email (nouvelle conversation)
                                            </label>
                                        </div>

                                        <!-- Email History -->
                                        ${!state.isFirstEmail ? `
                                        <div>
                                            <label class="block font-semibold text-gray-700 mb-2">
                                                Historique des √©changes pr√©c√©dents
                                            </label>
                                            <textarea
                                                id="emailHistory"
                                                placeholder="Collez ici l'historique complet des emails pr√©c√©dents..."
                                                class="w-full h-32 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                oninput="state.emailHistory = this.value;"
                                            >${state.emailHistory}</textarea>
                                        </div>
                                        ` : ''}

                                        <!-- Email Content -->
                                        <div>
                                            <label class="block font-semibold text-gray-700 mb-2">
                                                Contenu / Instructions pour votre email
                                            </label>
                                            <textarea
                                                id="emailContent"
                                                placeholder="√âcrivez votre email ou donnez des instructions sur ce que vous voulez dire..."
                                                class="w-full h-48 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                oninput="state.newEmailContent = this.value;"
                                            >${state.newEmailContent}</textarea>
                                        </div>

                                        <!-- Settings Grid -->
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block font-semibold text-gray-700 mb-2 text-sm">Langue</label>
                                                <select 
                                                    id="language"
                                                    onchange="state.language = this.value;"
                                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="auto" ${state.language === 'auto' ? 'selected' : ''}>Auto-d√©tection</option>
                                                    <option value="fran√ßais" ${state.language === 'fran√ßais' ? 'selected' : ''}>Fran√ßais</option>
                                                    <option value="anglais" ${state.language === 'anglais' ? 'selected' : ''}>Anglais</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label class="block font-semibold text-gray-700 mb-2 text-sm">Ton</label>
                                                <select 
                                                    id="tone"
                                                    onchange="state.tone = this.value;"
                                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="professional" ${state.tone === 'professional' ? 'selected' : ''}>Professionnel</option>
                                                    <option value="friendly" ${state.tone === 'friendly' ? 'selected' : ''}>Amical</option>
                                                    <option value="casual" ${state.tone === 'casual' ? 'selected' : ''}>D√©contract√©</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label class="block font-semibold text-gray-700 mb-2 text-sm">Forme d'adresse</label>
                                                <select 
                                                    id="formality"
                                                    onchange="state.formality = this.value;"
                                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="vous" ${state.formality === 'vous' ? 'selected' : ''}>Vouvoiement</option>
                                                    <option value="tu" ${state.formality === 'tu' ? 'selected' : ''}>Tutoiement</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label class="block font-semibold text-gray-700 mb-2 text-sm">Longueur</label>
                                                <select 
                                                    id="length"
                                                    onchange="state.length = this.value;"
                                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="detailed" ${state.length === 'detailed' ? 'selected' : ''}>D√©taill√©e</option>
                                                    <option value="short" ${state.length === 'short' ? 'selected' : ''}>Courte</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Action Buttons -->
                                        <div class="space-y-3">
                                            <button
                                                onclick="handleGenerate()"
                                                ${state.isGenerating || !state.newEmailContent.trim() ? 'disabled' : ''}
                                                class="w-full bg-gradient-to-r from-blue-600 to-red-600 text-white py-3 px-6 rounded-lg font-semibold hover:from-blue-700 hover:to-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg"
                                            >
                                                ${state.isGenerating ? 'G√©n√©ration en cours...' : '‚ú® G√©n√©rer l\'email'}
                                            </button>

                                            <div class="grid grid-cols-2 gap-3">
                                                <button
                                                    onclick="handleAnalyze()"
                                                    ${state.isGenerating || !state.newEmailContent.trim() ? 'disabled' : ''}
                                                    class="bg-red-100 text-red-700 py-2 px-4 rounded-lg font-medium hover:bg-red-200 disabled:opacity-50 transition-all"
                                                >
                                                    üìß Analyser email re√ßu
                                                </button>
                                                <button
                                                    onclick="handleSummarize()"
                                                    ${state.isGenerating || (!state.emailHistory.trim() && !state.newEmailContent.trim()) ? 'disabled' : ''}
                                                    class="bg-blue-100 text-blue-700 py-2 px-4 rounded-lg font-medium hover:bg-blue-200 disabled:opacity-50 transition-all"
                                                >
                                                    üìù R√©sumer l'√©change
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Right Column - Output -->
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center">
                                            <label class="block font-semibold text-gray-700">
                                                Email g√©n√©r√©
                                            </label>
                                            ${state.generatedEmail && !state.generatedEmail.startsWith('‚ùå') ? `
                                            <div class="flex gap-2 items-center">
                                                <span class="text-sm text-gray-500">
                                                    ${wordCount} mots ¬∑ ${charCount} caract√®res
                                                </span>
                                                <button
                                                    onclick="handleCopy()"
                                                    class="flex items-center gap-2 bg-red-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-700 transition-all"
                                                >
                                                    ${state.isCopied ? icons.check + ' Copi√© !' : icons.copy + ' Copier'}
                                                </button>
                                            </div>
                                            ` : ''}
                                        </div>

                                        <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-4 min-h-[500px] whitespace-pre-wrap">
                                            ${state.isGenerating ? `
                                            <div class="flex items-center justify-center h-full">
                                                <div class="text-center">
                                                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                                                    <p class="text-gray-600">G√©n√©ration en cours...</p>
                                                </div>
                                            </div>
                                            ` : state.generatedEmail ? `
                                            <div class="text-gray-800 leading-relaxed">${state.generatedEmail}</div>
                                            ` : `
                                            <div class="flex items-center justify-center h-full text-gray-400">
                                                Votre email g√©n√©r√© appara√Ætra ici
                                            </div>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="mt-4 bg-green-50 border border-green-200 rounded-lg p-4 text-sm text-green-800">
                            ‚úÖ <strong>Connect√© :</strong> L'outil est pr√™t √† g√©n√©rer vos emails professionnels !
                        </div>
                    </div>
                </div>
            `;
        }

        // Initial render
        render();
    </script>
</body>
</html>